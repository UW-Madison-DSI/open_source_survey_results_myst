Traceback (most recent call last):
  File "/Users/mariaoros/Documents/DSI/2026/open_source_survey_results_myst/venv/lib/python3.13/site-packages/jupyter_core/utils/__init__.py", line 154, in wrapped
    asyncio.get_running_loop()
    ~~~~~~~~~~~~~~~~~~~~~~~~^^
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/mariaoros/Documents/DSI/2026/open_source_survey_results_myst/venv/lib/python3.13/site-packages/jupyter_cache/executors/utils.py", line 58, in single_nb_execution
    executenb(
    ~~~~~~~~~^
        nb,
        ^^^
    ...<4 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/Users/mariaoros/Documents/DSI/2026/open_source_survey_results_myst/venv/lib/python3.13/site-packages/nbclient/client.py", line 1319, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/mariaoros/Documents/DSI/2026/open_source_survey_results_myst/venv/lib/python3.13/site-packages/jupyter_core/utils/__init__.py", line 158, in wrapped
    return loop.run_until_complete(inner)
           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.7/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/mariaoros/Documents/DSI/2026/open_source_survey_results_myst/venv/lib/python3.13/site-packages/nbclient/client.py", line 709, in async_execute
    await self.async_execute_cell(
        cell, index, execution_count=self.code_cells_executed + 1
    )
  File "/Users/mariaoros/Documents/DSI/2026/open_source_survey_results_myst/venv/lib/python3.13/site-packages/nbclient/client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/Users/mariaoros/Documents/DSI/2026/open_source_survey_results_myst/venv/lib/python3.13/site-packages/nbclient/client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
# Imports
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go
from pathlib import Path
import plotly.io as pio
import matplotlib as mpl
from myst_nb import glue

from setup import *

df = survey_results


# ----- Figure 1: "Value of a vibrant culture" by Respondent Type -----

# Map / order categories to match your R code
qid24_order = [
    "Very valuable",
    "Some value", 
    "Neutral",
    "No value"
]

valuable_pct = np.round(100*len(df[df['QID24']=="Very valuable"])/len(df))
glue("valuable_pct", valuable_pct)


df_c1 = (
    df.assign(
        QID4=df["QID4"].map(fill_unaffiliated),
        QID24=pd.Categorical(df["QID24"], categories=qid24_order, ordered=True)
    )
    .rename(columns={"QID4": "Respondent Type"})
)

# Group and compute percentages over all responses (like your R code)
c1_df = (
    df_c1.groupby(["QID24", "Respondent Type"], observed=True, dropna=False)
         .size()
         .reset_index(name="Count")
)
c1_df["Percent"] = c1_df["Count"] / len(df)

fig1 = px.bar(
    c1_df, x="QID24", y="Percent",
    color="Respondent Type",
    barmode="stack",
    title='"Do you see value in having a vibrant culture around open source software?"'
)
fig1.update_layout(
    yaxis=dict(tickformat=".1%"),
    xaxis_title="",
    plot_bgcolor="white",
    paper_bgcolor="white"
)
fig1.show()
fig1.write_html('_static/plotly_example.html', full_html=False, include_plotlyjs='cdn')
------------------


[31m---------------------------------------------------------------------------[39m
[31mNameError[39m                                 Traceback (most recent call last)
[36mCell[39m[36m [39m[32mIn[1][39m[32m, line 25[39m
[32m     15[39m [38;5;66;03m# ----- Figure 1: "Value of a vibrant culture" by Respondent Type -----[39;00m
[32m     16[39m 
[32m     17[39m [38;5;66;03m# Map / order categories to match your R code[39;00m
[32m     18[39m qid24_order = [
[32m     19[39m     [33m"[39m[33mVery valuable[39m[33m"[39m,
[32m     20[39m     [33m"[39m[33mSome value[39m[33m"[39m, 
[32m     21[39m     [33m"[39m[33mNeutral[39m[33m"[39m,
[32m     22[39m     [33m"[39m[33mNo value[39m[33m"[39m
[32m     23[39m ]
[32m---> [39m[32m25[39m valuable_pct = [43mnp[49m.round([32m100[39m*[38;5;28mlen[39m(df[df[[33m'[39m[33mQID24[39m[33m'[39m]==[33m"[39m[33mVery valuable[39m[33m"[39m])/[38;5;28mlen[39m(df))
[32m     26[39m glue([33m"[39m[33mvaluable_pct[39m[33m"[39m, valuable_pct)
[32m     29[39m df_c1 = (
[32m     30[39m     df.assign(
[32m     31[39m         QID4=df[[33m"[39m[33mQID4[39m[33m"[39m].map(fill_unaffiliated),
[32m   (...)[39m[32m     34[39m     .rename(columns={[33m"[39m[33mQID4[39m[33m"[39m: [33m"[39m[33mRespondent Type[39m[33m"[39m})
[32m     35[39m )

[31mNameError[39m: name 'np' is not defined

